#!/bin/sh

# Definição do diretório de chroot
CHROOT_DIR="/tmp/alpine"
ALPINE_TAR="alpine-minirootfs-3.21.3-armhf.tar.gz"
ALPINE_URL="https://dl-cdn.alpinelinux.org/alpine/latest-stable/releases/armhf/$ALPINE_TAR"

# Verifica se a pasta do chroot existe, se não, cria
if [ ! -d "$CHROOT_DIR" ]; then
    echo "Criando diretório $CHROOT_DIR..."
    mkdir -p "$CHROOT_DIR"
fi

# Baixa o Alpine se o arquivo não existir
if [ ! -f "$CHROOT_DIR/$ALPINE_TAR" ]; then
    echo "Baixando Alpine Linux..."
    wget -O "$CHROOT_DIR/$ALPINE_TAR" "$ALPINE_URL"
fi

# Extrai o Alpine se ainda não estiver extraído
if [ ! -d "$CHROOT_DIR/bin" ]; then
    echo "Extraindo Alpine Linux..."
    tar -xzf "$CHROOT_DIR/$ALPINE_TAR" -C "$CHROOT_DIR"
    
    # Remove o arquivo tar após a extração
    echo "Removendo arquivo $ALPINE_TAR..."
    rm -f "$CHROOT_DIR/$ALPINE_TAR"
fi

# Monta os sistemas de arquivos necessários
echo "Montando sistemas de arquivos..."
mount -t proc /proc "$CHROOT_DIR/proc"
mount --rbind /sys "$CHROOT_DIR/sys"
mount --rbind /dev "$CHROOT_DIR/dev"

# Entra no chroot
echo "Entrando no chroot..."
exec chroot "$CHROOT_DIR" /bin/sh
